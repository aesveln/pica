<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:camel="http://camel.apache.org/schema/spring"

       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="

	http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd        
	http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">


    <!-- ================================================================= -->
    <!-- PROTOCOL EXPOSITION FOR REMOTE SERVICES -->
    <!-- ================================================================= -->

    <camel:routeContext id="protocolos-taller-context"
                        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                        xmlns="http://universal-bank/crm/enterprise-model/framework/1.0.0"
                        xmlns:il="http://aesveln.com.co/transfor/il/">

        <camel:route id="protocolo-rabbitmq-composicion">
            <camel:from
                    uri="rabbitmq:35.235.105.138:5672/QueueExchange?username=fran&amp;autoDelete=false&amp;password=fran&amp;queue=UBQueue"/>
            <camel:doTry>
                <camel:to
                        uri="validator:file:/home/narfco/Dropbox/Aesof/2018-3/PICA/aes-pica-taller-middleware/canonical-domain-model/src/main/resources/contract/universal-bank-business-events.xsd"/>
                <!--<camel:to-->
                <!--uri="validator:file:/mnt/FRAND/Dropbox/Aesof/2018-3/PICA/aes-pica-taller-middleware/canonical-domain-model/src/main/resources/contract/universal-bank-business-events.xsd"/>-->
                <camel:log message="Validation OK"/>
                <camel:to uri="file:/home/narfco/Software/ArchviosFuse/data-valid"/>
                <camel:split>
                    <camel:xpath>//*[name() =
                        'CRMBusinessEvent']/*[name()='enterpriseOperationEventObject']
                    </camel:xpath>
                    <camel:to uri="xslt:spring/routes-adaptadores/xslt/enterpriseOperationEventObjectTransform.xsl"/>
                    <camel:log message="obtenido transformado: ${body}"/>
                    <camel:setProperty propertyName="infoCustomer">
                        <camel:xpath>/il:objetoEventoOperacion/il:informacionUsuario
                        </camel:xpath>
                    </camel:setProperty>
                    <camel:log message="Customer info :  ${exchangeProperty[infoCustomer]}"/>
                    <camel:split>
                        <camel:xpath>
                            /il:objetoEventoOperacion/il:objectoAccionFinanciera
                        </camel:xpath>
                        <camel:log message="Mensaje recibido: objectoAccionFinanciera"/>
                        <camel:to uri="direct:composicion-taller"/>
                    </camel:split>
                </camel:split>
                <camel:doCatch>
                    <camel:exception>org.apache.camel.ValidationException</camel:exception>
                    <camel:to uri="file:/home/narfco/Software/ArchviosFuse/data-invalid"/>
                    <camel:log message="Error Validation"/>
                </camel:doCatch>
                <!--
                <doFinally>
                    <to uri="file:test/src/data/finally"/>
                </doFinally>
                -->
            </camel:doTry>

        </camel:route>

    </camel:routeContext>

</beans>